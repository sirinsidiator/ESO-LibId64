-- SPDX-FileCopyrightText: 2023 sirinsidiator
--
-- SPDX-License-Identifier: Artistic-2.0

if not Taneth then return end
Taneth("LibId64", function()
    describe("arithmetics", function()
        describe("add", function()
            local cases = {
                {"0", "0", "0"},
                {"1", "1", "2"},
                {"1", "2", "3"},
                {"2147483647", "0", "2147483647"},
                {"2147483647", "1", "2147483648"},
                {"2147483647", "2", "2147483649"},
                {"2147483647", "2147483647", "4294967294"},
                {"4294967296", "0", "4294967296"},
                {"4294967296", "1", "4294967297"},
                {"4294967296", "2", "4294967298"},
                {"4294967296", "4294967296", "8589934592"},
                {"9007199254740991", "0", "9007199254740991"},
                {"9007199254740991", "1", "9007199254740992"},
                {"9007199254740991", "2", "9007199254740993"},
                {"9007199254740991", "9007199254740991", "18014398509481982"},
                {"9223372036854775807", "0", "9223372036854775807"},
                {"9223372036854775807", "1", "9223372036854775808"},
                {"9223372036854775807", "2", "9223372036854775809"},
                {"9223372036854775807", "9223372036854775807", "18446744073709551614"},
                {"9223372036854775808", "0", "9223372036854775808"},
                {"9223372036854775808", "1", "9223372036854775809"},
                {"9223372036854775808", "2", "9223372036854775810"},
                {"9223372036854775808", "9223372036854775808", "18446744073709551615"},
                {"18446744073709551615", "0", "18446744073709551615"},
                {"18446744073709551615", "1", "18446744073709551615"},
                {"18446744073709551615", "2", "18446744073709551615"},
                {"18446744073709551615", "18446744073709551615", "18446744073709551615"},
                {"18446744073709551616", "0", "18446744073709551615"},
                {"18446744073709551616", "1", "18446744073709551615"},
                {"18446744073709551616", "2", "18446744073709551615"},
                {"18446744073709551616", "18446744073709551616", "18446744073709551615"},
            }
            for i = 1, #cases do
                local a, b, expected = unpack(cases[i])
                it(a .. " + " .. b, function()
                    local a = id64(a)
                    local b = id64(b)
                    local result1 = tostring(a + b)
                    assert.equals(expected, result1)
                    local result2 = tostring(b + a)
                    assert.equals(expected, result2)
                end)
            end
        end)
        
        describe("subtract", function()
            local cases = {
                {"0", "0", "0"},
                {"0", "1", "18446744073709551615"},
                {"0", "2", "18446744073709551614"},
                {"1", "1", "0"},
                {"2", "1", "1"},
                {"1", "2", "18446744073709551615"},
                {"2147483647", "0", "2147483647"},
                {"2147483648", "1", "2147483647"},
                {"2147483649", "2", "2147483647"},
                {"4294967294", "2147483647", "2147483647"},
                {"4294967296", "0", "4294967296"},
                {"4294967297", "1", "4294967296"},
                {"4294967298", "2", "4294967296"},
                {"8589934592", "4294967296", "4294967296"},
                {"9007199254740991", "0", "9007199254740991"},
                {"9007199254740992", "1", "9007199254740991"},
                {"9007199254740993", "2", "9007199254740991"},
                {"18014398509481982", "9007199254740991", "9007199254740991"},
                {"9223372036854775807", "0", "9223372036854775807"},
                {"9223372036854775808", "1", "9223372036854775807"},
                {"9223372036854775809", "2", "9223372036854775807"},
                {"18446744073709551614", "9223372036854775807", "9223372036854775807"},
                {"9223372036854775808", "0", "9223372036854775808"},
                {"9223372036854775809", "1", "9223372036854775808"},
                {"9223372036854775810", "2", "9223372036854775808"},
                {"9223372036854775808", "9223372036854775808", "0"},
                {"18446744073709551615", "0", "18446744073709551615"},
                {"18446744073709551615", "18446744073709551615", "0"},
                {"18446744073709551616", "0", "18446744073709551615"},
                {"18446744073709551616", "1", "18446744073709551614"},
                {"18446744073709551616", "2", "18446744073709551613"},
                {"18446744073709551616", "18446744073709551616", "0"},
            }
            for i = 1, #cases do
                local a, b, expected = unpack(cases[i])
                it(a .. " - " .. b, function()
                    local a = id64(a)
                    local b = id64(b)
                    local result = tostring(a - b)
                    assert.equals(expected, result)
                end)
            end
        end)
    end)
end)